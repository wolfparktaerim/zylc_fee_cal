(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerPolicy&&(t.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?t.credentials="include":n.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function l(n){if(n.ep)return;n.ep=!0;const t=a(n);fetch(n.href,t)}})();const w={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_feeData:'[{"p1": [50, 120, 3]},{"p2": [50, 120, 3]},{"p3": [55, 140, 3]},{"p4": [55, 140, 3]},{"p5": [60, 160, 5]},{"p6": [60, 160, 5]},{"s1": [70, 160, 5]},{"s2": [70, 160, 5]},{"s3": [75, 180, 5]},{"s4": [75, 180, 5]},{"Cl+Hcl": 65},{"deposit": 200},{"registration-fee": 50},{"2025-new" : 80}]',VITE_holidays:'{"gazettedHolidays": ["2025-01-01","2025-01-29","2025-01-30","2025-03-31","2025-04-18","2025-05-01","2025-05-12","2025-06-07","2025-08-09","2025-10-20","2025-12-25"],"centerHolidays": ["2025-01-28", "2025-01-29", "2025-01-30", "2025-01-31", "2025-02-01", "2025-02-02","2025-06-02", "2025-06-03", "2025-06-04", "2025-06-05", "2025-06-06", "2025-06-07", "2025-06-08","2025-12-15", "2025-12-16", "2025-12-17", "2025-12-18", "2025-12-19", "2025-12-20", "2025-12-21", "2025-12-22", "2025-12-23", "2025-12-24", "2025-12-25", "2025-12-26", "2025-12-27", "2025-12-28", "2025-12-29", "2025-12-30", "2025-12-31"]}'};let m=[],y=[];async function B(){console.log(w),m=JSON.parse('[{"p1": [50, 120, 3]},{"p2": [50, 120, 3]},{"p3": [55, 140, 3]},{"p4": [55, 140, 3]},{"p5": [60, 160, 5]},{"p6": [60, 160, 5]},{"s1": [70, 160, 5]},{"s2": [70, 160, 5]},{"s3": [75, 180, 5]},{"s4": [75, 180, 5]},{"Cl+Hcl": 65},{"deposit": 200},{"registration-fee": 50},{"2025-new" : 80}]'),y=JSON.parse('{"gazettedHolidays": ["2025-01-01","2025-01-29","2025-01-30","2025-03-31","2025-04-18","2025-05-01","2025-05-12","2025-06-07","2025-08-09","2025-10-20","2025-12-25"],"centerHolidays": ["2025-01-28", "2025-01-29", "2025-01-30", "2025-01-31", "2025-02-01", "2025-02-02","2025-06-02", "2025-06-03", "2025-06-04", "2025-06-05", "2025-06-06", "2025-06-07", "2025-06-08","2025-12-15", "2025-12-16", "2025-12-17", "2025-12-18", "2025-12-19", "2025-12-20", "2025-12-21", "2025-12-22", "2025-12-23", "2025-12-24", "2025-12-25", "2025-12-26", "2025-12-27", "2025-12-28", "2025-12-29", "2025-12-30", "2025-12-31"]}'),y=[...y.gazettedHolidays,...y.centerHolidays]}B().then(()=>{document.getElementById("generate").addEventListener("click",C)});function C(){console.log("Generate button clicked.");const s=parseInt(document.getElementById("year").value,10),e=document.getElementById("level").value,a=document.getElementById("subject").value,l=document.getElementById("day").value,n=document.getElementById("teacher").value,t=document.getElementById("timeslot").value,r=parseInt(document.getElementById("paymentFrequency").value,10),o=document.getElementById("studentType").value,d=document.getElementById("classType").value,c=document.getElementById("additionalNote").value,u=document.getElementById("newStudentNote"),g=document.getElementById("addNote");c!=""&&(g.innerText=`Additional note: ${c}`,g.style.visibility="visible"),o=="new"?u.style.display="block":u.style.display="none";const f=m.find(i=>Object.keys(i)[0]===e);if(!f){console.error("Level not found:",e),alert("Selected level does not exist.");return}let p=f[e][0];if(d=="one-to-one"&&(p=f[e][1]),a=="Cl+Hcl"&&(e=="p5"||e=="p6"))for(const i of m)i.hasOwnProperty("Cl+Hcl")&&(p=i["Cl+Hcl"]);if(o=="new"&&e=="s4")for(const i of m)i.hasOwnProperty("2025-new")&&(p=i["2025-new"]);if((a=="Hcl"||a=="amath")&&e=="s4")for(const i of m)i.hasOwnProperty("2025-new")&&(p=i["2025-new"]);let h=f[e][2];(d=="one-to-one"||r>3)&&(h=0),document.getElementById("outputTitle").textContent=`Tuition Fee Payment Details ${s} - ${e.toUpperCase()} ${a.toUpperCase()}`,document.getElementById("teacherInfo").textContent=`Teacher in charge: ${n} | Day & Time: ${l.toUpperCase()} ${t}`;const $=document.getElementById("feeTable"),b=L(s,l,p,h,r);if(!b){console.error("Failed to generate table HTML."),alert("There was an error generating the table.");return}$.innerHTML=b,document.getElementById("outputContainer").classList.remove("hidden"),document.getElementById("downloadPdf").addEventListener("click",N),document.getElementById("downloadPdf").classList.remove("hidden")}function L(s,e,a,l,n){const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return`
        <table class="min-w-full border border-gray-300">
            <thead>
                <tr>
                    <th class="p-2 border bg-gray-100"></th>
                    ${t.map(o=>`<th class="p-2 border bg-gray-100">${o}-${s.toString().slice(-2)}</th>`).join("")}
                </tr>
            </thead>
            <tbody>
                <tr><td class="p-2 border">Dates with Lessons 上课日期</td>${t.map(o=>`<td class="p-2 border">${v(o,s,e).join(", ")}</td>`).join("")}</tr>
                <tr><td class="p-2 border">Dates on Break 休息日期</td>${t.map(o=>`<td class="p-2 border">${E(o,s,e).join(", ")}</td>`).join("")}</tr>
                <tr><td class="p-2 border">Number of Lessons 课程数</td>${t.map(o=>`<td class="p-2 border">${D(o,s,e)}</td>`).join("")}</tr>
                <tr><td class="p-2 border">Tuition Fee per Lesson 每节课学费</td>${t.map(o=>`<td class="p-2 border">${a}</td>`).join("")}</tr>
               <tr><td class="p-2 border">Material Fee per Month 材料费</td><td class="p-2 border text-center" colspan="${t.length}">${l}</td></tr>
                <tr><td class="p-2 border">Calculated Fee per Month 计算月学费</td>${t.map(o=>`<td class="p-2 border">${I(o,s,a,l,e)}</td>`).join("")}</tr>
                <tr><td class="p-2 border">Total Fee 总学费 </td>${M(t,s,a,l,e,n)}</tr>
            </tbody>
        </table>
    `}function v(s,e,a){const n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].indexOf(s),r={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6}[a.toLowerCase()],o=[],d=new Date(e,n,1);for(;d.getMonth()===n;){if(d.getDay()===r){const c=`${d.getDate()}/${n+1}`;E(s,e,a).includes(c)||o.push(c)}d.setDate(d.getDate()+1)}return o}function E(s,e,a){const l=[],t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].indexOf(s),o={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6}[a.toLowerCase()];return y.forEach(d=>{const c=new Date(d);if(c.getFullYear()===e&&c.getMonth()===t&&c.getDay()===o){const u=`${c.getDate()}/${t+1}`;l.push(u)}}),l}function D(s,e,a){return v(s,e,a).length}function I(s,e,a,l,n){return D(s,e,n)*a+l}function M(s,e,a,l,n,t){return s.map((r,o)=>o%t===0?`<td class="p-2 border">${s.slice(o,o+t).reduce((c,u)=>c+I(u,e,a,l,n),0)}</td>`:'<td class="p-2 border"></td>').join("")}function N(){const s=parseInt(document.getElementById("year").value,10),e=document.getElementById("level").value,a=document.getElementById("subject").value,l=document.getElementById("day").value,n=document.getElementById("teacher").value;console.log("Download button pressed");const t=document.getElementById("outputContainer"),r=`${s}-${e.toUpperCase()}-${a.toUpperCase()}-${l.toUpperCase()}-${n}.pdf`,o=document.getElementById("downloadPdf");o.style.display="none",t.classList.remove("hidden"),html2pdf().set({margin:.2,filename:r,image:{type:"jpeg",quality:.98},html2canvas:{scale:.7},jsPDF:{unit:"in",format:"a3",orientation:"landscape"}}).from(t).save().then(()=>{o.style.display="block"}).catch(d=>{console.error("PDF generation failed:",d),o.style.display="block"})}
